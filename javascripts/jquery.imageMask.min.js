/**
 * jQuery imageMask
 * @author Almog Baku - almog.baku@gmail.com
 * @see https://github.com/AlmogBaku/imageMask
 * 
 * @version 0.1b
 * @license MIT License
 */

(function(f){var i=0,b=null,e=null,g=null;f.fn.imageMask=function(h){if(void 0==h||!this.is("img"))return!1;null==e&&(h.src?e=h:(e=new Image,e.src=h));this.each(function(){var c=f(this),a;a=c.attr("id")?c.attr("id"):i++;a="imageMask_"+a+"_canvas";b=f("<canvas>").attr({id:a,"class":c.attr("class"),style:c.attr("style"),width:e.width,height:e.height}).insertAfter(c)[0];c=b.getContext("2d");null==g&&(c.drawImage(e,0,0),g=c.getImageData(0,0,b.width,b.height),c.clearRect(0,0,b.width,b.height));a=f(this)[0]; var d=1;a.width>b.width&&(d=b.width/a.width);a.height>b.height&&(d=b.height/a.height);c.drawImage(a,0,0,a.width,a.height,0,0,a.width*d,a.height*d);a=c.getImageData(0,0,b.width,b.height);for(d=0;d<a.data.length;d+=4)a.data[d+3]=g.data[d+3];c.putImageData(a,0,0);f(this).remove()});g=e=b=null;return this}})(jQuery);