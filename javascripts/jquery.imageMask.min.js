/**
 * jQuery imageMask
 * @author Almog Baku - almog.baku@gmail.com
 * @see https://github.com/AlmogBaku/imageMask
 * 
 * @version 0.1b
 * @license MIT License
 */

(function(e){var k=0,c=null,h=null;e.fn.imageMask=function(a){if(void 0==a||!this.is("img"))return!1;var b;a.src?b=a:(b=new Image,b.src=a);var j=this;e(b).load(function(){j.each(function(){c=h=null;var f,a=b;f=e(this);var i;i=f.attr("id")?f.attr("id"):k++;i="imageMask_"+i+"_canvas";c=e("<canvas>").attr({id:i,"class":f.attr("class"),style:f.attr("style"),width:a.width,height:a.height}).insertAfter(f)[0];var g=c.getContext("2d");null==h&&(g.drawImage(b,0,0),h=g.getImageData(0,0,c.width,c.height),g.clearRect(0, 0,c.width,c.height));var d=new Image;d.src=e(this).attr("src");e(d).load(function(){var a=1,a=d.width>d.height?c.height/d.height:c.width/d.width;g.drawImage(d,0,0,d.width,d.height,0,0,d.width*a,d.height*a);for(var a=g.getImageData(0,0,c.width,c.height),b=0;b<a.data.length;b+=4)a.data[b+3]=h.data[b+3];g.putImageData(a,0,0);e(j).remove()})})});return this}})(jQuery);