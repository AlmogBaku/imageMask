function isCanvasSupported(){var e=document.createElement("canvas");return!!(e.getContext&&e.getContext("2d"))}if(isCanvasSupported()){(function(e){function n(n,r,i){var s=r.height;var o=r.width;if(i==1){var s=n.width+"px";var o=n.height+"px"}n=e(n);var u;if(n.attr("id")){u=n.attr("id")}else{u=t++}u="imageMask_"+u+"_canvas";return e("<canvas>").attr({id:u,"class":n.attr("class"),style:n.attr("style"),width:s,height:o}).css("visibility","").insertAfter(n)}function r(e,t,n){t.drawImage(n,0,0,e.width,e.width);var r=t.getImageData(0,0,e.width,e.height);t.clearRect(0,0,e.width,e.height);return r}function i(e,t,n){var r=1;if(n.width>n.height){r=e.height/n.height}else{r=e.width/n.width}t.drawImage(n,0,0,n.width,n.height,0,0,n.width*r,n.height*r)}function s(e,t,n){var r=t.getImageData(0,0,e.width,e.height);for(var i=0;i<r.data.length;i+=4){r.data[i+3]=n.data[i+3]}t.mozImageSmoothingEnabled=false;t.putImageData(r,0,0)}var t=0;e.fn.imageMask=function(t,o,u){if(t==undefined){console.error("imageMask: undefined mask");return false}if(!this.is("img")){console.error("imageMask: jQuery object MUST be an img element");return false}if(o!=undefined&&!e.isFunction(o)){console.error("imageMask: callback MUST be function");return false}var a=null;if(t.src){a=t}else{a=new Image;a.crossOrigin="Anonymous";a.src=t}var f=this;f.css("visibility","hidden");e(a).load(function(){var t=null;f.each(function(){var f=e(this),l=null;l=n(this,a,u)[0];var c=l.getContext("2d");var h=new Image;h.crossOrigin="Anonymous";h.src=e(this).attr("src");e(h).load(function(){t=r(l,c,a);i(l,c,h);s(l,c,t);f.remove();if(e.isFunction(o)){o(l)}})})});return this}})(jQuery)}
